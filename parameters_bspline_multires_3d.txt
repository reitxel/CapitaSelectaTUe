// Example parameter file for B-spline registration

// The internal pixel type, used for internal computations
// Leave to float in general.
// NB: this is not the type of the input images! The pixel
// type of the input images is automatically read from the
// images themselves.
(FixedInternalImagePixelType "float")
(MovingInternalImagePixelType "float")

// The dimensions of the fixed and moving image, changed them from 2 to 3
(FixedImageDimension 3)
(MovingImageDimension 3)

// Registration setup
(Registration "MultiResolutionRegistration")
// change number of resolutions from 5 to 4, base paper
(NumberOfResolutions 4)
// Define pyramids of both images at multiple scales
(FixedImagePyramid "FixedSmoothingImagePyramid")
(MovingImagePyramid "MovingSmoothingImagePyramid")

// Optimizer, change the standard to the adaptative, improvement
(Optimizer "AdaptiveStochasticGradientDescent")
// Maximum number of iterations in each resolution level, :
(MaximumNumberOfIterations 2500 2500 2500 2500)


// Transformation
(Transform "BSplineTransform")
// The control point spacing of the bspline transformation in
// the finest resolution level, before was 4. 
(FinalGridSpacingInPhysicalUnits 8.0 8.0 8.0)

// Metric, before it was the advanced correlation
// check the different with local mutual information
(Metric "NormalizedMutualInformation")
//(SubtractMean "true")
//(NumberOfSpatialSamples 4096)

// Refresh these spatial samples in every iteration, and select
// them randomly. 
(NewSamplesEveryIteration "true")
(ImageSampler "RandomCoordinate")

// Order of B-Spline interpolation used during registration/optimisation.
(BSplineInterpolationOrder 1)

// Order of B-Spline interpolation used for applying the final
// deformation.
(FinalBSplineInterpolationOrder 3)

//Default pixel value for pixels that come from outside the picture:
(DefaultPixelValue 0)

// Choose whether to generate the deformed moving image.
(WriteResultImage "true")

// The pixel type and format of the resulting deformed moving image
(ResultImagePixelType "short")
(ResultImageFormat "mhd")




// Some settings to avoid warnings
(UseDirectionCosines "true")
(Interpolator "BSplineInterpolator")
(ResampleInterpolator "FinalBSplineInterpolator")
(Resampler "DefaultResampler")
(HowToCombineTransforms "Compose")
(ErodeMask "false")
(AutomaticScalesEstimation "true")
(MaximumStepLength 1.0)
(MinimumStepLength 0.01) 
(BSplineTransformSplineOrder 3)
(UseCyclicTransform "false")
(ShowExactMetricValue "false")
(CheckNumberOfSamples "true")
(FixedImageBSplineInterpolationOrder 1)
(UseRandomSampleRegion "false")
(MinimumGradientMagnitude 1e-08)
(RelaxationFactor 0.5)



